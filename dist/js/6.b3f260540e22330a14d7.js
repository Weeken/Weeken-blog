(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{MxQc:function(t,a,e){"use strict";var r=e("TqRt");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var s,n,o,i,u=r(e("o0o1")),d=r(e("yXPU")),l=e("ta7f"),c={name:"user",props:["userInfo"],data:function(){return{token:"",showCropper:!1,originImg:"",croppedImg:"",imageData:{src:"",imageOptions:{}},form:{oldPassword:"",newPassword:"",repeatPassword:""}}},validations:{form:{oldPassword:{required:l.required,minLength:(0,l.minLength)(6)},newPassword:{required:l.required,minLength:(0,l.minLength)(6)},repeatPassword:{required:l.required,sameAsPassword:(0,l.sameAs)("newPassword")}}},methods:{hideCropper:function(){this.showCropper=!1,this.originImg=""},logout:function(){var t=this;this.Alert.success("退出登录"),this.$storage.removeItem("user"),setTimeout(function(){t.$router.replace("/note"),t.$emit("logout")},2e3)},resetPassword:(i=(0,d.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$http.resetPassword(this.userInfo.id,this.form);case 2:t.sent&&(this.Alert.success("修改成功，请重新登录"),this.$storage.removeItem("user"),setTimeout(function(){location.reload()},2e3));case 4:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)}),changeAvatar:(o=(0,d.default)(u.default.mark(function t(){var a;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$http.changeAvatar(this.userInfo.id,this.imageData);case 2:if(!t.sent){t.next=9;break}return this.Alert.success("修改成功"),t.next=7,this.$http.getUserInfo(this.userInfo.id);case 7:(a=t.sent)&&(this.$storage.setItem("user",a.data),this.croppedImg="",location.reload());case 9:case"end":return t.stop()}},t,this)})),function(){return o.apply(this,arguments)}),uploadImg:(n=(0,d.default)(u.default.mark(function t(a){var e,r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(e=new FormData).append("file",a),t.next=4,this.$http.upload(this.token,e);case 4:(r=t.sent)&&(e.delete("file"),this.originImg=this.createNativePic(a),this.imageData.src="http://p0ry9w0d5.bkt.clouddn.com/".concat(r.key),this.showCropper=!0,this.$refs.file.value="");case 6:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)}),createNativePic:function(t){var a;return void 0!==window.createObjectURL?a=window.createObjectURL(t):void 0!==window.URL?a=window.URL.createObjectURL(t):void 0!==window.webkitURL&&(a=window.webkitURL.createObjectURL(t)),a},getImg:function(t){var a=t.target.files[0],e="image/jpeg"===a.type||"image/png"===a.type,r=a.size/1024/1024<2;e?r?this.uploadImg(a):this.Alert.error("上传头像图片大小不能超过 2MB!"):this.Alert.error("上传头像图片只能是 JPG 或 PNG 格式!")},getToken:(s=(0,d.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$http.getUpToken();case 2:this.token=t.sent.token;case 3:case"end":return t.stop()}},t,this)})),function(){return s.apply(this,arguments)})},created:function(){this.getToken()}};a.default=c},OI41:function(t,a,e){var r=e("Xv3C");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);(0,e("SZ7m").default)("341ee8b0",r,!1,{})},VZdt:function(t,a,e){"use strict";e.d(a,"a",function(){return r}),e.d(a,"b",function(){return s});var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"user"},[e("div",{staticClass:"user_avatar"},[e("div",{staticClass:"avatar_wrap"},[e("input",{ref:"file",attrs:{type:"file"},on:{change:function(a){t.getImg(a)}}}),t._v(" "),t.croppedImg?e("img",{attrs:{src:t.croppedImg,alt:""}}):e("img",{attrs:{src:t.userInfo.avatar,alt:""}}),t._v(" "),e("div",{staticClass:"tips"},[t._v("点击修改头像")])]),t._v(" "),t.croppedImg?e("div",{staticClass:"avatar_submit"},[e("button",{attrs:{type:"button",name:"button"},on:{click:t.changeAvatar}},[t._v("提交")])]):t._e()]),t._v(" "),t.showCropper?e("vue-cropper",{attrs:{img:t.originImg,ratio:1,result:t.croppedImg,imgData:t.imageData.imageOptions},on:{"update:result":function(a){t.croppedImg=a},"update:imgData":function(a){t.$set(t.imageData,"imageOptions",a)},close:t.hideCropper}}):t._e(),t._v(" "),e("div",{staticClass:"user_field"},[e("h2",[t._v("个人资料")]),t._v(" "),e("div",{staticClass:"block"},[e("label",[t._v("邮箱：")]),e("span",[t._v(t._s(t.userInfo.email))])]),t._v(" "),e("div",{staticClass:"block"},[e("label",[t._v("昵称：")]),e("span",[t._v(t._s(t.userInfo.name))])]),t._v(" "),e("div",{staticClass:"block"},[e("label",[t._v("身份：")]),e("span",[t._v(t._s(t.userInfo.type))])])]),t._v(" "),e("div",{staticClass:"user_field"},[e("h2",[t._v("修改密码")]),t._v(" "),e("div",{staticClass:"block"},[e("label",[t._v("原密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.oldPassword,expression:"form.oldPassword"}],attrs:{type:"password"},domProps:{value:t.form.oldPassword},on:{blur:function(a){t.$v.form.oldPassword.$touch()},input:function(a){a.target.composing||t.$set(t.form,"oldPassword",a.target.value)}}}),t._v(" "),t.$v.form.oldPassword.$dirty&&!t.$v.form.oldPassword.minLength?e("span",{staticClass:"error_massage"},[t._v("密码至少6个字符")]):t._e()]),t._v(" "),e("div",{staticClass:"block"},[e("label",[t._v("新密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.newPassword,expression:"form.newPassword"}],attrs:{type:"password"},domProps:{value:t.form.newPassword},on:{blur:function(a){t.$v.form.newPassword.$touch()},input:function(a){a.target.composing||t.$set(t.form,"newPassword",a.target.value)}}}),t._v(" "),t.$v.form.newPassword.$dirty&&!t.$v.form.newPassword.minLength?e("span",{staticClass:"error_massage"},[t._v("密码至少6个字符")]):t._e()]),t._v(" "),e("div",{staticClass:"block"},[e("label",[t._v("确认新密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.repeatPassword,expression:"form.repeatPassword"}],attrs:{type:"password"},domProps:{value:t.form.repeatPassword},on:{blur:function(a){t.$v.form.repeatPassword.$touch()},input:function(a){a.target.composing||t.$set(t.form,"repeatPassword",a.target.value)}}}),t._v(" "),t.$v.form.repeatPassword.$dirty&&!t.$v.form.repeatPassword.sameAsPassword?e("span",{staticClass:"error_massage"},[t._v("两次密码输入不一致")]):t._e()]),t._v(" "),e("div",{staticClass:"block"},[e("button",{staticClass:"submit",attrs:{disabled:t.$v.form.$invalid},on:{click:function(a){return a.preventDefault(),t.resetPassword(a)}}},[t._v("提交")])])]),t._v(" "),e("div",{staticClass:"user_field"},[e("h2",[t._v("退出登录")]),t._v(" "),e("div",{staticClass:"block"},[e("button",{staticClass:"logout",on:{click:function(a){return a.preventDefault(),t.logout(a)}}},[t._v("退出登录")])])])],1)},s=[];r._withStripped=!0},Xv3C:function(t,a,e){var r=e("sEG9");(t.exports=e("I1BE")(!1)).push([t.i,"\n.user[data-v-57a901a4] {\n  width: 800px;\n  margin: 30px auto;\n  background: #fff;\n  border-radius: 5px;\n  padding: 20px 30px;\n  position: relative;\n}\n.user .user_avatar[data-v-57a901a4] {\n  position: absolute;\n  width: 100px;\n  height: 140px;\n  right: 80px;\n  top: 80px;\n}\n.user .user_avatar > .avatar_wrap[data-v-57a901a4] {\n  width: 100%;\n  height: 100px;\n  background: #f3f3f3;\n  background-image: url("+r(e("wSGE"))+');\n  background-repeat: no-repeat;\n  background-size: cover;\n  border-radius: 50%;\n  overflow: hidden;\n  position: relative;\n}\n.user .user_avatar > .avatar_wrap > img[data-v-57a901a4] {\n  width: 100%;\n  height: 100%;\n  border: 0;\n}\n.user .user_avatar > .avatar_wrap > input[type="file"][data-v-57a901a4] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 10;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  cursor: pointer;\n}\n.user .user_avatar > .avatar_wrap > input[type="file"]:hover ~ .tips[data-v-57a901a4] {\n  -webkit-transform: translateY(-100%);\n      -ms-transform: translateY(-100%);\n          transform: translateY(-100%);\n}\n.user .user_avatar > .avatar_wrap > .tips[data-v-57a901a4] {\n  position: absolute;\n  top: 100%;\n  z-index: 5;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.2);\n  font: 12px/100px microsoft yahei;\n  text-align: center;\n  color: #fff;\n  transition: all .3s ease;\n}\n.user .user_avatar > .avatar_submit[data-v-57a901a4] {\n  position: absolute;\n  width: 100%;\n  bottom: 0;\n}\n.user .user_avatar > .avatar_submit > button[data-v-57a901a4] {\n  display: block;\n  width: 60%;\n  height: 30px;\n  margin: 0 auto;\n  font: 14px/30px microsoft yahei;\n  background: #2196f3;\n  border-radius: 3px;\n  color: #fff;\n  cursor: pointer;\n}\n.user .user_field[data-v-57a901a4] {\n  margin-bottom: 20px;\n}\n.user .user_field h2[data-v-57a901a4] {\n  width: 100%;\n  font: 18px/30px microsoft yahei;\n  color: #2196f3;\n  margin-bottom: 20px;\n}\n.user .user_field .block[data-v-57a901a4] {\n  width: 100%;\n  height: 40px;\n  margin-bottom: 10px;\n}\n.user .user_field .block > label[data-v-57a901a4],\n.user .user_field .block > span[data-v-57a901a4],\n.user .user_field .block > input[data-v-57a901a4] {\n  display: inline-block;\n  vertical-align: middle;\n  font: 14px/40px microsoft yahei;\n}\n.user .user_field .block > .error_massage[data-v-57a901a4] {\n  color: red;\n  margin-left: 10px;\n}\n.user .user_field .block > label[data-v-57a901a4] {\n  margin: 0 20px;\n  width: 100px;\n}\n.user .user_field .block > input[data-v-57a901a4] {\n  width: 200px;\n  height: 40px;\n  background: #f3f3f3;\n  border-radius: 3px;\n  padding: 0 10px;\n}\n.user .user_field .block > .submit[data-v-57a901a4],\n.user .user_field .block > .logout[data-v-57a901a4] {\n  width: 200px;\n  height: 40px;\n  background: #2196f3;\n  border-radius: 3px;\n  color: #fff;\n  cursor: pointer;\n  margin: 0 140px;\n}\n.user .user_field .block > .submit[data-v-57a901a4]:hover,\n.user .user_field .block > .logout[data-v-57a901a4]:hover {\n  background-color: #3fa4f4;\n}\n.user .user_field .block > .submit[disabled="disabled"][data-v-57a901a4],\n.user .user_field .block > .logout[disabled="disabled"][data-v-57a901a4] {\n  cursor: not-allowed;\n  background-color: #ccc;\n}\n',""])},wSGE:function(t,a,e){t.exports=e.p+"images/user.png"},xEnz:function(t,a,e){"use strict";e.r(a);var r=e("MxQc"),s=e.n(r);for(var n in r)"default"!==n&&function(t){e.d(a,t,function(){return r[t]})}(n);var o=e("VZdt"),i=e("JFUb"),u=!1;var d=function(t){u||e("OI41")},l=Object(i.a)(s.a,o.a,o.b,!1,d,"data-v-57a901a4",null);l.options.__file="src/pages/hasTabs/user/user.vue",a.default=l.exports}}]);