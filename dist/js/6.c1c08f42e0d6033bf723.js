(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{OI41:function(a,t,e){var r=e("Xv3C");"string"==typeof r&&(r=[[a.i,r,""]]),r.locals&&(a.exports=r.locals);(0,e("SZ7m").default)("341ee8b0",r,!1,{})},Xv3C:function(a,t,e){var r=e("sEG9");(a.exports=e("I1BE")(!1)).push([a.i,"\n.user[data-v-57a901a4] {\n  width: 800px;\n  margin: 30px auto;\n  background: #fff;\n  border-radius: 5px;\n  padding: 20px 30px;\n  position: relative;\n}\n.user .user_avatar[data-v-57a901a4] {\n  position: absolute;\n  width: 100px;\n  height: 140px;\n  right: 80px;\n  top: 80px;\n}\n.user .user_avatar > .avatar_wrap[data-v-57a901a4] {\n  width: 100%;\n  height: 100px;\n  background: #f3f3f3;\n  background-image: url("+r(e("wSGE"))+');\n  background-repeat: no-repeat;\n  background-size: cover;\n  border-radius: 50%;\n  overflow: hidden;\n  position: relative;\n}\n.user .user_avatar > .avatar_wrap > img[data-v-57a901a4] {\n  width: 100%;\n  height: 100%;\n  border: 0;\n}\n.user .user_avatar > .avatar_wrap > input[type="file"][data-v-57a901a4] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 10;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  cursor: pointer;\n}\n.user .user_avatar > .avatar_wrap > input[type="file"]:hover ~ .tips[data-v-57a901a4] {\n  -webkit-transform: translateY(-100%);\n      -ms-transform: translateY(-100%);\n          transform: translateY(-100%);\n}\n.user .user_avatar > .avatar_wrap > .tips[data-v-57a901a4] {\n  position: absolute;\n  top: 100%;\n  z-index: 5;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.2);\n  font: 12px/100px microsoft yahei;\n  text-align: center;\n  color: #fff;\n  transition: all .3s ease;\n}\n.user .user_avatar > .avatar_submit[data-v-57a901a4] {\n  position: absolute;\n  width: 100%;\n  bottom: 0;\n}\n.user .user_avatar > .avatar_submit > button[data-v-57a901a4] {\n  display: block;\n  width: 60%;\n  height: 30px;\n  margin: 0 auto;\n  font: 14px/30px microsoft yahei;\n  background: #2196f3;\n  border-radius: 3px;\n  color: #fff;\n  cursor: pointer;\n}\n.user .user_field[data-v-57a901a4] {\n  margin-bottom: 20px;\n}\n.user .user_field h2[data-v-57a901a4] {\n  width: 100%;\n  font: 18px/30px microsoft yahei;\n  color: #2196f3;\n  margin-bottom: 20px;\n}\n.user .user_field .block[data-v-57a901a4] {\n  width: 100%;\n  height: 40px;\n  margin-bottom: 10px;\n}\n.user .user_field .block > label[data-v-57a901a4],\n.user .user_field .block > span[data-v-57a901a4],\n.user .user_field .block > input[data-v-57a901a4] {\n  display: inline-block;\n  vertical-align: middle;\n  font: 14px/40px microsoft yahei;\n}\n.user .user_field .block > .error_massage[data-v-57a901a4] {\n  color: red;\n  margin-left: 10px;\n}\n.user .user_field .block > label[data-v-57a901a4] {\n  margin: 0 20px;\n  width: 100px;\n}\n.user .user_field .block > input[data-v-57a901a4] {\n  width: 200px;\n  height: 40px;\n  background: #f3f3f3;\n  border-radius: 3px;\n  padding: 0 10px;\n}\n.user .user_field .block > .submit[data-v-57a901a4],\n.user .user_field .block > .logout[data-v-57a901a4] {\n  width: 200px;\n  height: 40px;\n  background: #2196f3;\n  border-radius: 3px;\n  color: #fff;\n  cursor: pointer;\n  margin: 0 140px;\n}\n.user .user_field .block > .submit[data-v-57a901a4]:hover,\n.user .user_field .block > .logout[data-v-57a901a4]:hover {\n  background-color: #3fa4f4;\n}\n.user .user_field .block > .submit[disabled="disabled"][data-v-57a901a4],\n.user .user_field .block > .logout[disabled="disabled"][data-v-57a901a4] {\n  cursor: not-allowed;\n  background-color: #ccc;\n}\n',""])},wSGE:function(a,t,e){a.exports=e.p+"images/user.png"},xEnz:function(a,t,e){"use strict";e.r(t);var r,s,n,o,i=e("o0o1"),d=e.n(i),u=e("yXPU"),c=e.n(u),p=e("ta7f"),l={name:"user",props:["userInfo"],data:function(){return{token:"",showCropper:!1,originImg:"",croppedImg:"",imageData:{src:"",imageOptions:{}},form:{oldPassword:"",newPassword:"",repeatPassword:""}}},validations:{form:{oldPassword:{required:p.required,minLength:Object(p.minLength)(6)},newPassword:{required:p.required,minLength:Object(p.minLength)(6)},repeatPassword:{required:p.required,sameAsPassword:Object(p.sameAs)("newPassword")}}},methods:{hideCropper:function(){this.showCropper=!1,this.originImg=""},logout:function(){var a=this;this.Alert.success("退出登录"),this.$storage.removeItem("user"),setTimeout(function(){a.$router.replace("/note"),a.$emit("logout")},2e3)},resetPassword:(o=c()(d.a.mark(function a(){return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.$http.resetPassword(this.userInfo.id,this.form);case 2:a.sent&&(this.Alert.success("修改成功，请重新登录"),this.$storage.removeItem("user"),setTimeout(function(){location.reload()},2e3));case 4:case"end":return a.stop()}},a,this)})),function(){return o.apply(this,arguments)}),changeAvatar:(n=c()(d.a.mark(function a(){var t;return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.$http.changeAvatar(this.userInfo.id,this.imageData);case 2:if(!a.sent){a.next=9;break}return this.Alert.success("修改成功"),a.next=7,this.$http.getUserInfo(this.userInfo.id);case 7:(t=a.sent)&&(this.$storage.setItem("user",t.data),this.croppedImg="",location.reload());case 9:case"end":return a.stop()}},a,this)})),function(){return n.apply(this,arguments)}),uploadImg:(s=c()(d.a.mark(function a(t){var e,r;return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return(e=new FormData).append("file",t),a.next=4,this.$http.upload(this.token,e);case 4:(r=a.sent)&&(e.delete("file"),this.originImg=this.createNativePic(t),this.imageData.src="http://p0ry9w0d5.bkt.clouddn.com/".concat(r.key),this.showCropper=!0,this.$refs.file.value="");case 6:case"end":return a.stop()}},a,this)})),function(a){return s.apply(this,arguments)}),createNativePic:function(a){var t;return void 0!==window.createObjectURL?t=window.createObjectURL(a):void 0!==window.URL?t=window.URL.createObjectURL(a):void 0!==window.webkitURL&&(t=window.webkitURL.createObjectURL(a)),t},getImg:function(a){var t=a.target.files[0],e="image/jpeg"===t.type||"image/png"===t.type,r=t.size/1024/1024<2;e?r?this.uploadImg(t):this.Alert.error("上传头像图片大小不能超过 2MB!"):this.Alert.error("上传头像图片只能是 JPG 或 PNG 格式!")},getToken:(r=c()(d.a.mark(function a(){return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.$http.getUpToken();case 2:this.token=a.sent.token;case 3:case"end":return a.stop()}},a,this)})),function(){return r.apply(this,arguments)})},created:function(){this.getToken()}},v=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"user"},[e("div",{staticClass:"user_avatar"},[e("div",{staticClass:"avatar_wrap"},[e("input",{ref:"file",attrs:{type:"file"},on:{change:function(t){a.getImg(t)}}}),a._v(" "),a.croppedImg?e("img",{attrs:{src:a.croppedImg,alt:""}}):e("img",{attrs:{src:a.userInfo.avatar,alt:""}}),a._v(" "),e("div",{staticClass:"tips"},[a._v("点击修改头像")])]),a._v(" "),a.croppedImg?e("div",{staticClass:"avatar_submit"},[e("button",{attrs:{type:"button",name:"button"},on:{click:a.changeAvatar}},[a._v("提交")])]):a._e()]),a._v(" "),a.showCropper?e("vue-cropper",{attrs:{img:a.originImg,ratio:1,result:a.croppedImg,imgData:a.imageData.imageOptions},on:{"update:result":function(t){a.croppedImg=t},"update:imgData":function(t){a.$set(a.imageData,"imageOptions",t)},close:a.hideCropper}}):a._e(),a._v(" "),e("div",{staticClass:"user_field"},[e("h2",[a._v("个人资料")]),a._v(" "),e("div",{staticClass:"block"},[e("label",[a._v("邮箱：")]),e("span",[a._v(a._s(a.userInfo.email))])]),a._v(" "),e("div",{staticClass:"block"},[e("label",[a._v("昵称：")]),e("span",[a._v(a._s(a.userInfo.name))])]),a._v(" "),e("div",{staticClass:"block"},[e("label",[a._v("身份：")]),e("span",[a._v(a._s(a.userInfo.type))])])]),a._v(" "),e("div",{staticClass:"user_field"},[e("h2",[a._v("修改密码")]),a._v(" "),e("div",{staticClass:"block"},[e("label",[a._v("原密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.form.oldPassword,expression:"form.oldPassword"}],attrs:{type:"password"},domProps:{value:a.form.oldPassword},on:{blur:function(t){a.$v.form.oldPassword.$touch()},input:function(t){t.target.composing||a.$set(a.form,"oldPassword",t.target.value)}}}),a._v(" "),a.$v.form.oldPassword.$dirty&&!a.$v.form.oldPassword.minLength?e("span",{staticClass:"error_massage"},[a._v("密码至少6个字符")]):a._e()]),a._v(" "),e("div",{staticClass:"block"},[e("label",[a._v("新密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.form.newPassword,expression:"form.newPassword"}],attrs:{type:"password"},domProps:{value:a.form.newPassword},on:{blur:function(t){a.$v.form.newPassword.$touch()},input:function(t){t.target.composing||a.$set(a.form,"newPassword",t.target.value)}}}),a._v(" "),a.$v.form.newPassword.$dirty&&!a.$v.form.newPassword.minLength?e("span",{staticClass:"error_massage"},[a._v("密码至少6个字符")]):a._e()]),a._v(" "),e("div",{staticClass:"block"},[e("label",[a._v("确认新密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.form.repeatPassword,expression:"form.repeatPassword"}],attrs:{type:"password"},domProps:{value:a.form.repeatPassword},on:{blur:function(t){a.$v.form.repeatPassword.$touch()},input:function(t){t.target.composing||a.$set(a.form,"repeatPassword",t.target.value)}}}),a._v(" "),a.$v.form.repeatPassword.$dirty&&!a.$v.form.repeatPassword.sameAsPassword?e("span",{staticClass:"error_massage"},[a._v("两次密码输入不一致")]):a._e()]),a._v(" "),e("div",{staticClass:"block"},[e("button",{staticClass:"submit",attrs:{disabled:a.$v.form.$invalid},on:{click:function(t){return t.preventDefault(),a.resetPassword(t)}}},[a._v("提交")])])]),a._v(" "),e("div",{staticClass:"user_field"},[e("h2",[a._v("退出登录")]),a._v(" "),e("div",{staticClass:"block"},[e("button",{staticClass:"logout",on:{click:function(t){return t.preventDefault(),a.logout(t)}}},[a._v("退出登录")])])])],1)};v._withStripped=!0;var f=e("JFUb"),m=!1;var h=function(a){m||e("OI41")},g=Object(f.a)(l,v,[],!1,h,"data-v-57a901a4",null);g.options.__file="src/pages/hasTabs/user/user.vue";t.default=g.exports}}]);