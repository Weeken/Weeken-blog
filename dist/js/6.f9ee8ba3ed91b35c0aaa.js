(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{MxQc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a("ta7f");function n(e){return function(){var t=this,a=arguments;return new Promise(function(r,n){var s=e.apply(t,a);function o(e,t){try{var a=s[e](t),o=a.value}catch(e){return void n(e)}a.done?r(o):Promise.resolve(o).then(i,u)}function i(e){o("next",e)}function u(e){o("throw",e)}i()})}}var s,o,i,u,d={name:"user",props:["userInfo"],data:function(){return{token:"",showCropper:!1,originImg:"",croppedImg:"",imageData:{src:"",imageOptions:{}},form:{oldPassword:"",newPassword:"",repeatPassword:""}}},validations:{form:{oldPassword:{required:r.required,minLength:(0,r.minLength)(6)},newPassword:{required:r.required,minLength:(0,r.minLength)(6)},repeatPassword:{required:r.required,sameAsPassword:(0,r.sameAs)("newPassword")}}},methods:{hideCropper:function(){this.showCropper=!1,this.originImg=""},logout:function(){var e=this;this.Alert.success("退出登录"),this.$storage.removeItem("user"),setTimeout(function(){e.$router.replace("/note"),e.$emit("logout")},2e3)},resetPassword:(u=n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$http.resetPassword(this.userInfo.id,this.form);case 2:e.sent&&(this.Alert.success("修改成功，请重新登录"),this.$storage.removeItem("user"),setTimeout(function(){location.reload()},2e3));case 4:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)}),changeAvatar:(i=n(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$http.changeAvatar(this.userInfo.id,this.imageData);case 2:if(!e.sent){e.next=9;break}return this.Alert.success("修改成功"),e.next=7,this.$http.getUserInfo(this.userInfo.id);case 7:(t=e.sent)&&(this.$storage.setItem("user",t.data),this.croppedImg="",location.reload());case 9:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)}),uploadImg:(o=n(regeneratorRuntime.mark(function e(t){var a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("file",t),e.next=4,this.$http.upload(this.token,a);case 4:(r=e.sent)&&(a.delete("file"),this.originImg=this.createNativePic(t),this.imageData.src="http://p0ry9w0d5.bkt.clouddn.com/".concat(r.key),this.showCropper=!0,this.$refs.file.value="");case 6:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)}),createNativePic:function(e){var t;return void 0!==window.createObjectURL?t=window.createObjectURL(e):void 0!==window.URL?t=window.URL.createObjectURL(e):void 0!==window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t},getImg:function(e){var t=e.target.files[0],a="image/jpeg"===t.type||"image/png"===t.type,r=t.size/1024/1024<2;a?r?this.uploadImg(t):this.Alert.error("上传头像图片大小不能超过 2MB!"):this.Alert.error("上传头像图片只能是 JPG 或 PNG 格式!")},getToken:(s=n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$http.getUpToken();case 2:this.token=e.sent.token;case 3:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},created:function(){this.getToken()}};t.default=d},OI41:function(e,t,a){var r=a("Xv3C");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a("SZ7m").default)("341ee8b0",r,!1,{})},VZdt:function(e,t,a){"use strict";a.d(t,"a",function(){return r}),a.d(t,"b",function(){return n});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user"},[a("div",{staticClass:"user_avatar"},[a("div",{staticClass:"avatar_wrap"},[a("input",{ref:"file",attrs:{type:"file"},on:{change:function(t){e.getImg(t)}}}),e._v(" "),e.croppedImg?a("img",{attrs:{src:e.croppedImg,alt:""}}):a("img",{attrs:{src:e.userInfo.avatar,alt:""}}),e._v(" "),a("div",{staticClass:"tips"},[e._v("点击修改头像")])]),e._v(" "),e.croppedImg?a("div",{staticClass:"avatar_submit"},[a("button",{attrs:{type:"button",name:"button"},on:{click:e.changeAvatar}},[e._v("提交")])]):e._e()]),e._v(" "),e.showCropper?a("vue-cropper",{attrs:{img:e.originImg,ratio:1,result:e.croppedImg,imgData:e.imageData.imageOptions},on:{"update:result":function(t){e.croppedImg=t},"update:imgData":function(t){e.$set(e.imageData,"imageOptions",t)},close:e.hideCropper}}):e._e(),e._v(" "),a("div",{staticClass:"user_field"},[a("h2",[e._v("个人资料")]),e._v(" "),a("div",{staticClass:"block"},[a("label",[e._v("邮箱：")]),a("span",[e._v(e._s(e.userInfo.email))])]),e._v(" "),a("div",{staticClass:"block"},[a("label",[e._v("昵称：")]),a("span",[e._v(e._s(e.userInfo.name))])]),e._v(" "),a("div",{staticClass:"block"},[a("label",[e._v("身份：")]),a("span",[e._v(e._s(e.userInfo.type))])])]),e._v(" "),a("div",{staticClass:"user_field"},[a("h2",[e._v("修改密码")]),e._v(" "),a("div",{staticClass:"block"},[a("label",[e._v("原密码：")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.oldPassword,expression:"form.oldPassword"}],attrs:{type:"password"},domProps:{value:e.form.oldPassword},on:{blur:function(t){e.$v.form.oldPassword.$touch()},input:function(t){t.target.composing||e.$set(e.form,"oldPassword",t.target.value)}}}),e._v(" "),e.$v.form.oldPassword.$dirty&&!e.$v.form.oldPassword.minLength?a("span",{staticClass:"error_massage"},[e._v("密码至少6个字符")]):e._e()]),e._v(" "),a("div",{staticClass:"block"},[a("label",[e._v("新密码：")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.newPassword,expression:"form.newPassword"}],attrs:{type:"password"},domProps:{value:e.form.newPassword},on:{blur:function(t){e.$v.form.newPassword.$touch()},input:function(t){t.target.composing||e.$set(e.form,"newPassword",t.target.value)}}}),e._v(" "),e.$v.form.newPassword.$dirty&&!e.$v.form.newPassword.minLength?a("span",{staticClass:"error_massage"},[e._v("密码至少6个字符")]):e._e()]),e._v(" "),a("div",{staticClass:"block"},[a("label",[e._v("确认新密码：")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.repeatPassword,expression:"form.repeatPassword"}],attrs:{type:"password"},domProps:{value:e.form.repeatPassword},on:{blur:function(t){e.$v.form.repeatPassword.$touch()},input:function(t){t.target.composing||e.$set(e.form,"repeatPassword",t.target.value)}}}),e._v(" "),e.$v.form.repeatPassword.$dirty&&!e.$v.form.repeatPassword.sameAsPassword?a("span",{staticClass:"error_massage"},[e._v("两次密码输入不一致")]):e._e()]),e._v(" "),a("div",{staticClass:"block"},[a("button",{staticClass:"submit",attrs:{disabled:e.$v.form.$invalid},on:{click:function(t){return t.preventDefault(),e.resetPassword(t)}}},[e._v("提交")])])]),e._v(" "),a("div",{staticClass:"user_field"},[a("h2",[e._v("退出登录")]),e._v(" "),a("div",{staticClass:"block"},[a("button",{staticClass:"logout",on:{click:function(t){return t.preventDefault(),e.logout(t)}}},[e._v("退出登录")])])])],1)},n=[];r._withStripped=!0},Xv3C:function(e,t,a){var r=a("sEG9");(e.exports=a("I1BE")(!1)).push([e.i,"\n.user[data-v-57a901a4] {\n  width: 800px;\n  margin: 30px auto;\n  background: #fff;\n  border-radius: 5px;\n  padding: 20px 30px;\n  position: relative;\n}\n.user .user_avatar[data-v-57a901a4] {\n  position: absolute;\n  width: 100px;\n  height: 140px;\n  right: 80px;\n  top: 80px;\n}\n.user .user_avatar > .avatar_wrap[data-v-57a901a4] {\n  width: 100%;\n  height: 100px;\n  background: #f3f3f3;\n  background-image: url("+r(a("wSGE"))+');\n  background-repeat: no-repeat;\n  background-size: cover;\n  border-radius: 50%;\n  overflow: hidden;\n  position: relative;\n}\n.user .user_avatar > .avatar_wrap > img[data-v-57a901a4] {\n  width: 100%;\n  height: 100%;\n  border: 0;\n}\n.user .user_avatar > .avatar_wrap > input[type="file"][data-v-57a901a4] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 10;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  cursor: pointer;\n}\n.user .user_avatar > .avatar_wrap > input[type="file"]:hover ~ .tips[data-v-57a901a4] {\n  -webkit-transform: translateY(-100%);\n      -ms-transform: translateY(-100%);\n          transform: translateY(-100%);\n}\n.user .user_avatar > .avatar_wrap > .tips[data-v-57a901a4] {\n  position: absolute;\n  top: 100%;\n  z-index: 5;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.2);\n  font: 12px/100px microsoft yahei;\n  text-align: center;\n  color: #fff;\n  transition: all .3s ease;\n}\n.user .user_avatar > .avatar_submit[data-v-57a901a4] {\n  position: absolute;\n  width: 100%;\n  bottom: 0;\n}\n.user .user_avatar > .avatar_submit > button[data-v-57a901a4] {\n  display: block;\n  width: 60%;\n  height: 30px;\n  margin: 0 auto;\n  font: 14px/30px microsoft yahei;\n  background: #2196f3;\n  border-radius: 3px;\n  color: #fff;\n  cursor: pointer;\n}\n.user .user_field[data-v-57a901a4] {\n  margin-bottom: 20px;\n}\n.user .user_field h2[data-v-57a901a4] {\n  width: 100%;\n  font: 18px/30px microsoft yahei;\n  color: #2196f3;\n  margin-bottom: 20px;\n}\n.user .user_field .block[data-v-57a901a4] {\n  width: 100%;\n  height: 40px;\n  margin-bottom: 10px;\n}\n.user .user_field .block > label[data-v-57a901a4],\n.user .user_field .block > span[data-v-57a901a4],\n.user .user_field .block > input[data-v-57a901a4] {\n  display: inline-block;\n  vertical-align: middle;\n  font: 14px/40px microsoft yahei;\n}\n.user .user_field .block > .error_massage[data-v-57a901a4] {\n  color: red;\n  margin-left: 10px;\n}\n.user .user_field .block > label[data-v-57a901a4] {\n  margin: 0 20px;\n  width: 100px;\n}\n.user .user_field .block > input[data-v-57a901a4] {\n  width: 200px;\n  height: 40px;\n  background: #f3f3f3;\n  border-radius: 3px;\n  padding: 0 10px;\n}\n.user .user_field .block > .submit[data-v-57a901a4],\n.user .user_field .block > .logout[data-v-57a901a4] {\n  width: 200px;\n  height: 40px;\n  background: #2196f3;\n  border-radius: 3px;\n  color: #fff;\n  cursor: pointer;\n  margin: 0 140px;\n}\n.user .user_field .block > .submit[data-v-57a901a4]:hover,\n.user .user_field .block > .logout[data-v-57a901a4]:hover {\n  background-color: #3fa4f4;\n}\n.user .user_field .block > .submit[disabled="disabled"][data-v-57a901a4],\n.user .user_field .block > .logout[disabled="disabled"][data-v-57a901a4] {\n  cursor: not-allowed;\n  background-color: #ccc;\n}\n',""])},wSGE:function(e,t,a){e.exports=a.p+"images/user.png"},xEnz:function(e,t,a){"use strict";a.r(t);var r=a("MxQc"),n=a.n(r);for(var s in r)"default"!==s&&function(e){a.d(t,e,function(){return r[e]})}(s);var o=a("VZdt"),i=a("JFUb"),u=!1;var d=function(e){u||a("OI41")},c=Object(i.a)(n.a,o.a,o.b,!1,d,"data-v-57a901a4",null);c.options.__file="src/pages/hasTabs/user/user.vue",t.default=c.exports}}]);